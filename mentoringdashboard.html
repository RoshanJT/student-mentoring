<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Christ Mentoring - Profile</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
            color: #fff;
        }

        body {
            background-color: #0a0f1b;
        }

        .navbar {
            background-color: #101828;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            flex-wrap: wrap;
        }

        .logo {
            font-weight: bold;
            font-size: 20px;
        }

        .logo span {
            font-weight: normal;
            color: #ccc;
            margin-left: 5px;
        }

        nav {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: none;
            border: none;
            color: #ccc;
            margin-left: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
        }

        .nav-btn:hover,
        .nav-btn.active {
            color: #00c8ff;
        }

        .logout-btn {
            background-color: #fff;
            color: #000;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 20px;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.3s ease;
        }

        .logout-btn:hover {
            background-color: #00c8ff;
            color: #fff;
            transform: scale(1.05);
        }

        main {
            padding: 40px;
        }

        .profile-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .avatar {
            width: 120px;
            height: 120px;
            background-color: #1f2937;
            border-radius: 50%;
            object-fit: cover;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .avatar.popup {
            transform: scale(1.5);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1.5);
            z-index: 1000;
            border: 4px solid #00c8ff;
            box-shadow: 0 0 15px #00c8ff;
        }

        .cards {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background-color: #1f2937;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 140px;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .performance,
        .skills,
        .growth {
            margin-top: 40px;
        }

        .gpa-section {
            background-color: #1f2937;
            padding: 20px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .gpa-number h1 {
            font-size: 40px;
        }

        .green {
            color: #2ecc71;
        }

        .skill {
            margin-top: 20px;
        }

        .skill-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .skill-info span {
            min-width: 40px;
            font-weight: bold;
            color: #00c8ff;
        }

        progress {
            width: 100%;
            height: 10px;
            appearance: none;
        }

        progress::-webkit-progress-bar {
            background-color: #2d3748;
            border-radius: 5px;
        }

        progress::-webkit-progress-value {
            background-color: #00c8ff;
            border-radius: 5px;
        }

        .attendance-section {
            margin-top: 40px;
        }

        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .attendance-item {
            background-color: #1f2937;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .attendance-item h4 {
            margin-bottom: 10px;
            color: #ccc;
            font-size: 14px;
        }

        .attendance-value, .credits-value, .gpa-value {
            font-size: 32px;
            font-weight: bold;
            color: #00c8ff;
            margin-bottom: 10px;
        }

        .attendance-bar {
            width: 100%;
            height: 8px;
            background-color: #2d3748;
            border-radius: 4px;
            overflow: hidden;
        }

        .attendance-fill {
            height: 100%;
            background-color: #2ecc71;
            transition: width 0.3s ease;
        }

        .credits-info, .gpa-info {
            font-size: 12px;
            color: #aaa;
        }

        .growth ul {
            margin-top: 10px;
            list-style: none;
        }

        .growth li {
            margin-bottom: 10px;
        }

        footer {
            background-color: #101828;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        .footer-links {
            margin-bottom: 10px;
        }

        .footer-links a {
            margin: 0 10px;
            color: #bbb;
            text-decoration: none;
            font-size: 14px;
        }
    </style>
</head>

<body>
    <header class="navbar">
        <div class="logo">CU <span>ChristMentoring</span></div>
        <nav>
            <button class="nav-btn" onclick="navigate('home')">Home</button>
            <button class="nav-btn active" onclick="navigate('profile')">Profile</button>
            <button class="nav-btn" onclick="navigate('meetings')">Meetings</button>
            <button class="nav-btn" onclick="navigate('feedback')">Feedback</button>
            <button class="logout-btn" onclick="navigate('logout')">Logout</button>
        </nav>
    </header>

    <main>
        <div class="profile-summary">
            <div class="user-info">
                <img class="avatar" src="avatar.png" alt="User Avatar" onclick="toggleAvatarPopup(this)">
                <div>
                    <h2>John Doe</h2>
                    <p>Computer Science Major<br>Christ University (SoET)</p>
                </div>
            </div>

            <div class="cards">
                <div class="card">
                    <h3>Attendance</h3>
                    <p>95%</p>
                </div>

                <div class="card">
                    <h3>Classes</h3>
                    <p>5 BTCS C</p>
                </div>

                <div class="card">
                    <h3>Total Credits</h3>
                    <p>80</p>
                </div>
            </div>
        </div>

        <div class="performance">
            <h3>Academic Performance</h3>
            <div class="gpa-section">
                <div class="gpa-number">
                    <h1>3.8 <span class="green">+5%</span></h1>
                </div>
            </div>
        </div>

        <div class="skills">
            <h3>Skills Development</h3>
            <div class="skill">
                <label>Communication Skills</label>
                <div class="skill-info">
                    <span id="commSkillValue">0%</span>
                    <progress id="commSkillProgress" value="0" max="100"></progress>
                </div>
            </div>
            <div class="skill">
                <label>Problem-Solving Skills</label>
                <div class="skill-info">
                    <span id="problemSkillValue">0%</span>
                    <progress id="problemSkillProgress" value="0" max="100"></progress>
                </div>
            </div>
            <div class="skill">
                <label>Teamwork Skills</label>
                <div class="skill-info">
                    <span id="teamSkillValue">0%</span>
                    <progress id="teamSkillProgress" value="0" max="100"></progress>
                </div>
            </div>
            <div class="skill">
                <label>Leadership Skills</label>
                <div class="skill-info">
                    <span id="leadSkillValue">0%</span>
                    <progress id="leadSkillProgress" value="0" max="100"></progress>
                </div>
            </div>
            <div class="skill">
                <label>Technical Skills</label>
                <div class="skill-info">
                    <span id="techSkillValue">0%</span>
                    <progress id="techSkillProgress" value="0" max="100"></progress>
                </div>
            </div>
        </div>

        <div class="attendance-section">
            <h3>Attendance & Credits</h3>
            <div class="attendance-grid">
                <div class="attendance-item">
                    <h4>Current Attendance</h4>
                    <div class="attendance-value" id="currentAttendance">0%</div>
                    <div class="attendance-bar">
                        <div class="attendance-fill" id="attendanceFill"></div>
                    </div>
                </div>
                <div class="attendance-item">
                    <h4>Total Credits</h4>
                    <div class="credits-value" id="totalCredits">0</div>
                    <div class="credits-info">Credits Completed</div>
                </div>
                <div class="attendance-item">
                    <h4>GPA</h4>
                    <div class="gpa-value" id="currentGPA">0.0</div>
                    <div class="gpa-info">Current Grade Point</div>
                </div>
            </div>
        </div>

        <div class="growth">
            <h3>Personal Growth</h3>
            <ul>
                <li>Completed 10 mentoring sessions (2 weeks ago)</li>
                <li>Participated in leadership workshop (1 month ago)</li>
                <li>Received positive feedback from mentor</li>
            </ul>
        </div>
    </main>

    <footer>
        <div class="footer-links">
            <a href="#">Home</a>
            <a href="#">About Us</a>
            <a href="#">Services</a>
            <a href="#">Contact</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
        </div>
        <p>© 2025 Christ Mentoring. All rights reserved.</p>
    </footer>

    <script src="frontend-config.js"></script>
    <script>
        // Check authentication and load data
        window.addEventListener('load', async () => {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'mentoringlogin.html';
                return;
            }

            await loadProfileData();
        });

        async function loadProfileData() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(apiUrl('/student/profile'), {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    updateProfile(data);
                } else {
                    console.error('Failed to load profile data');
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        function updateProfile(data) {
            const { user, stats } = data;

            if (user) {
                // Update user info
                const nameElement = document.querySelector('.user-info h2');
                const detailsElement = document.querySelector('.user-info p');
                
                if (nameElement) nameElement.textContent = user.name;
                if (detailsElement) detailsElement.innerHTML = `${user.program}<br>Christ University (SoET)`;

                // Update cards
                const cards = document.querySelectorAll('.card');
                if (cards.length >= 3) {
                    cards[0].querySelector('p').textContent = `${user.attendance}%`;
                    cards[1].querySelector('p').textContent = user.program;
                    cards[2].querySelector('p').textContent = user.totalCredits;
                }

                // Update GPA
                const gpaElement = document.querySelector('.gpa-number h1');
                if (gpaElement) {
                    gpaElement.innerHTML = `${user.gpa} <span class="green">+5%</span>`;
                }

                // Update skills
                if (user.skills) {
                    updateSkillsDisplay(user.skills);
                }

                // Update attendance and credits
                updateAttendanceAndCredits(user);
            }
        }

        function updateSkillsDisplay(skills) {
            // Update Communication Skills
            const commProgress = document.getElementById('commSkillProgress');
            const commValue = document.getElementById('commSkillValue');
            if (commProgress && commValue) {
                const commSkillValue = skills.communication || 0;
                commProgress.value = commSkillValue;
                commValue.textContent = `${commSkillValue}%`;
            }

            // Update Problem Solving Skills
            const problemProgress = document.getElementById('problemSkillProgress');
            const problemValue = document.getElementById('problemSkillValue');
            if (problemProgress && problemValue) {
                const problemSkillValue = skills.problemSolving || 0;
                problemProgress.value = problemSkillValue;
                problemValue.textContent = `${problemSkillValue}%`;
            }

            // Update Teamwork Skills
            const teamProgress = document.getElementById('teamSkillProgress');
            const teamValue = document.getElementById('teamSkillValue');
            if (teamProgress && teamValue) {
                const teamSkillValue = skills.teamwork || 0;
                teamProgress.value = teamSkillValue;
                teamValue.textContent = `${teamSkillValue}%`;
            }

            // Update Leadership Skills (calculated average)
            const leadProgress = document.getElementById('leadSkillProgress');
            const leadValue = document.getElementById('leadSkillValue');
            if (leadProgress && leadValue) {
                const leadSkillValue = Math.round((skills.communication + skills.problemSolving + skills.teamwork) / 3) || 0;
                leadProgress.value = leadSkillValue;
                leadValue.textContent = `${leadSkillValue}%`;
            }

            // Update Technical Skills (based on program)
            const techProgress = document.getElementById('techSkillProgress');
            const techValue = document.getElementById('techSkillValue');
            if (techProgress && techValue) {
                const techSkillValue = Math.round((skills.communication + skills.problemSolving) / 2) || 0;
                techProgress.value = techSkillValue;
                techValue.textContent = `${techSkillValue}%`;
            }
        }

        function updateAttendanceAndCredits(user) {
            // Update Attendance
            const attendanceValue = document.getElementById('currentAttendance');
            const attendanceFill = document.getElementById('attendanceFill');
            if (attendanceValue && attendanceFill) {
                const attendance = user.attendance || 0;
                attendanceValue.textContent = `${attendance}%`;
                attendanceFill.style.width = `${attendance}%`;
            }

            // Update Credits
            const creditsValue = document.getElementById('totalCredits');
            if (creditsValue) {
                creditsValue.textContent = user.totalCredits || 0;
            }

            // Update GPA
            const gpaValue = document.getElementById('currentGPA');
            if (gpaValue) {
                gpaValue.textContent = user.gpa || 0.0;
            }
        }

        function navigate(section) {
            if (section === 'logout') {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'mentoringlogin.html';
                return;
            }

            const routes = {
                home: 'index.html',
                profile: 'mentoringdashboard.html',
                meetings: 'mentoringschedule.html',
                feedback: 'mentoringfeedback.html',
                logout: 'mentoringlogin.html'
            };
            window.location.href = routes[section];
        }

        function toggleAvatarPopup(element) {
            element.classList.toggle('popup');
        }
    </script>
</body>

</html>
